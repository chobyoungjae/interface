# 불량체크일지 PRD (Product Requirements Document)

## 1. 프로젝트 개요

### 1.1 목적
제조 공정에서 발생하는 포장지/박스 불량을 체크하고 기록하는 웹 입력 시스템

### 1.2 기술 스택
- Next.js 15 + TypeScript + Tailwind CSS
- Google Sheets API (데이터 저장/조회)

---

## 2. 데이터 소스 구조

### 2.1 BOM 스프레드시트 (`BOM_SPREADSHEET_ID`)
| 하위 시트 | 용도 | 사용처 |
|-----------|------|--------|
| 시트1 | 배합일지용 제품 데이터 | 배합일지 (참고 - 사용 안함) |
| **시트2** | 불량체크일지용 제품 데이터 | **생산품 선택 드롭다운** |
| 시리얼로트 | 로트/재고 참조 데이터 | 포장지 로트 선택 |

#### BOM 시트2 구조
| 열 | 내용 | 용도 |
|----|------|------|
| A | 생산품목코드 | 제품 식별 |
| B | 생산품목명 | 드롭다운 표시 |
| F | 소모품목코드 | 포장지/박스 코드 (6자리) |
| G | 소모품목명 | 포장지/박스명 |

#### BOM 시리얼로트 시트 구조
| 열 | 내용 | 용도 |
|----|------|------|
| A | 품목코드 | F열 코드와 매칭 |
| B | 제품명 | 품목명 참조 |
| D | 시리얼/로트No. | 드롭다운 표시 |
| F | 재고수량 | 드롭다운 표시 |

### 2.2 저장 스프레드시트 (`STORAGE_SPREADSHEET_ID`)
| 하위 시트 | 용도 |
|-----------|------|
| **시트1** | 불량 데이터 저장 |
| B시트 | 작성자 목록 (참고 데이터) |

#### B시트 구조 (작성자 조회용)
| 열 | 내용 | 조건 |
|----|------|------|
| B | 이름 | 드롭다운에 표시 |
| C | 부서 | "생산팀"인 사람만 필터 |

---

## 3. 입력 필드 명세

### 3.1 작업자 (드롭다운)
- **데이터 소스**: 저장 시트 > B시트
- **필터 조건**: C열 = "생산팀"
- **표시 내용**: B열 (이름)
- **중복 제거**: O

### 3.2 라인 (드롭다운 - 고정값)
```
1라인, 2라인, 3라인, 4라인, 수작업, 배합실
```

### 3.3 생산품 선택 (드롭다운)
- **데이터 소스**: BOM 시트 > **시트2**
- **표시 형식**: `A열(코드) / B열(품목명)`
- **중복 제거**: O

### 3.4 포장지 자동선택 (자동 표시)
- **트리거**: 3.3 생산품 선택 시
- **로직**: BOM 시트2에서 **A열(생산품목코드)이 선택된 제품과 동일한 모든 행** 중 F열이 **6으로 시작하는 6자리 숫자**인 항목
- **표시 형식**: `F열(코드) / G열(품목명)`

### 3.5 포장지 로트 선택 (드롭다운)
- **트리거**: 생산품 선택 → 포장지 자동확정 → 로트 드롭다운 활성화
- **데이터 소스**: BOM 시트 > 시리얼로트 시트
- **매칭 조건**: 3.4 포장지의 F열(코드) = 시리얼로트 시트의 A열(품목코드)
- **표시 형식**: `D열(로트번호) / F열(재고수량)`
- **다중 로트**: 동일한 포장지 코드에 여러 로트가 존재할 수 있음 → 매칭되는 **모든 로트**를 드롭다운에 표시

### 3.6 포장지 불량 유형 및 수량 (숫자 입력 - 고정 항목)
| 불량 유형 | 입력 타입 |
|-----------|-----------|
| 실링불량 | 숫자 입력 |
| 중량불량 | 숫자 입력 |
| 날인불량 | 숫자 입력 |
| 자체불량 | 숫자 입력 |

### 3.7 박스 자동선택 (자동 표시)
- **트리거**: 3.3 생산품 선택 시
- **로직**: BOM 시트2에서 **A열(생산품목코드)이 선택된 제품과 동일한 모든 행** 중 F열이 **7로 시작하는 6자리 숫자**인 항목
- **표시 형식**: `F열(코드) / G열(품목명)`

### 3.8 박스 불량 유형 및 수량 (숫자 입력 - 고정 항목)
| 불량 유형 | 입력 타입 |
|-----------|-----------|
| 박스오염 | 숫자 입력 |
| 파손 | 숫자 입력 |
| 날인불량 | 숫자 입력 |
| 기타 | 숫자 입력 |

### 3.9 특이사항 (텍스트 입력)
| 필드 | 입력 타입 |
|------|-----------|
| 내용 | 단답형 텍스트 |
| 개선조치사항 | 단답형 텍스트 |
| 완료여부 | 단답형 텍스트 |

---

## 4. 저장 데이터 구조 (시트1)

데이터는 **가로 방향(열)**으로 저장됩니다.

| 열 | 헤더 | 내용 |
|----|------|------|
| A | 타임스탬프 | 제출 시간 (자동) |
| B | 작업자 | 선택된 작업자명 |
| C | 라인 | 선택된 라인 |
| D | 생산품코드 | 선택된 제품 A열 |
| E | 생산품명 | 선택된 제품 B열 |
| F | 포장지코드 | 자동선택된 포장지 F열 |
| G | 포장지명 | 자동선택된 포장지 G열 |
| H | 포장지로트 | 선택된 로트번호 |
| I | 실링불량 | 입력값 |
| J | 중량불량 | 입력값 |
| K | 날인불량(포장지) | 입력값 |
| L | 자체불량 | 입력값 |
| M | 박스코드 | 자동선택된 박스 F열 |
| N | 박스명 | 자동선택된 박스 G열 |
| O | 박스오염 | 입력값 |
| P | 파손 | 입력값 |
| Q | 날인불량(박스) | 입력값 |
| R | 기타 | 입력값 |
| S | 내용 | 특이사항 |
| T | 개선조치사항 | 특이사항 |
| U | 완료여부 | 특이사항 |

---

## 5. 화면 흐름

```
┌─────────────────────────────────────────────┐
│  불량체크일지                                │
├─────────────────────────────────────────────┤
│  1. 작업자        [드롭다운 ▼]              │
│  2. 라인          [드롭다운 ▼]              │
│  3. 생산품 선택   [드롭다운 ▼]              │
├─────────────────────────────────────────────┤
│  ▼ 생산품 선택 시 자동 표시                  │
├─────────────────────────────────────────────┤
│  4. 포장지        [자동: 코드 / 품목명]      │
│  5. 포장지 로트   [드롭다운 ▼]              │
│  6. 포장지 불량                              │
│     - 실링불량    [    ] 개                 │
│     - 중량불량    [    ] 개                 │
│     - 날인불량    [    ] 개                 │
│     - 자체불량    [    ] 개                 │
├─────────────────────────────────────────────┤
│  7. 박스          [자동: 코드 / 품목명]      │
│  8. 박스 불량                                │
│     - 박스오염    [    ] 개                 │
│     - 파손        [    ] 개                 │
│     - 날인불량    [    ] 개                 │
│     - 기타        [    ] 개                 │
├─────────────────────────────────────────────┤
│  9. 특이사항                                 │
│     - 내용           [            ]         │
│     - 개선조치사항   [            ]         │
│     - 완료여부       [            ]         │
├─────────────────────────────────────────────┤
│              [ 제출 ]                        │
└─────────────────────────────────────────────┘
```

---

## 6. 확인 필요 사항

### 6.1 코드 식별 로직 ✅ 확정
- 포장지: F열이 **6으로 시작하는 6자리 숫자**
- 박스: F열이 **7로 시작하는 6자리 숫자**

### 6.2 B시트 헤더 행 위치 ✅ 확정
- **4행**이 헤더

### 6.3 시리얼로트 시트 헤더 행 위치 ✅ 확정
- **2행**이 헤더

---

## 7. API 엔드포인트 설계

| 엔드포인트 | 메서드 | 용도 |
|------------|--------|------|
| `/api/workers` | GET | 작업자 목록 조회 (B시트) |
| `/api/products` | GET | 생산품 목록 조회 (BOM 시트2) |
| `/api/packaging` | GET | 포장지/박스 정보 조회 |
| `/api/serial-lot` | GET | 시리얼로트 조회 |
| `/api/save` | POST | 불량 데이터 저장 (시트1) |

---

## 8. 환경 변수

```env
BOM_SPREADSHEET_ID="1WlabNwKwMWW-cKA_go2Q680g3S7wYDpb5iCzE_YIZdM"
STORAGE_SPREADSHEET_ID="10zoJnnRuQQDh_VYR5QdVPjjH_Wg4VEcr9t_E-ytp0iQ"
GOOGLE_SERVICE_ACCOUNT_EMAIL="서비스계정이메일"
GOOGLE_PRIVATE_KEY="서비스계정키"
```
